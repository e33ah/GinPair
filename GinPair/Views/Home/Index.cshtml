@model GinPair.Models.PairingVM

@{
    ViewData["Title"] = "Home";
}

<div class="container text-center">
    <h1 class="display-4">Welcome to Gin Pair</h1>
    <p class="mt-4">Your ultimate guide to the perfect gin and tonic pairing!<br>
        Find your favorite gin, and we'll show you the perfect tonic pairing.</p>
    <form asp-action="Index" method="get" class="row d-flex flex-row align-items-center mb-2 justify-content-center">
        <div class="col-4">
            <input id="ginSearchBox" type="text" name="searchString" placeholder="Start typing a gin..." value="@ViewData["CurrentFilter"]" class="form-control p-2" />
        </div>
        <div class="col-auto">
            <button id="ginSearchButton" type="submit" class="btn btn-primary">Search</button>
        </div> 
    </form>
    
    @if (!String.IsNullOrEmpty(Model.Message))
    {
        <p class="mt-4">@Html.Raw(Model.Message)</p>
    }
    <div id="searchResult"></div>
</div>


@section Scripts 
{
    <script type="text/javascript"> 
        document.getElementById("ginSearchBox").addEventListener("input", function (e) { 
            var regex = /^[a-zA-Z0-9'& ]*$/; 
            var input = e.target.value; 
            if (!regex.test(input)) 
            { 
                e.target.value = input.slice(0, -1); 
            } 
        });
        // $(document).ready(function(){
        //     $.ajax({
        //         url: '/api/ginapi',
        //         type: 'GET',
        //         success: function(response) {
        //             $("#data").html(response);
        //         },
        //         error: function(xhr, status, error){
        //             $("#data").html("An error occured: " + error);
        //         }
        //     });
        // });       
        $(document).ready(function(){
            $("#ginSearchBox").autocomplete({
                source: function(request, response){
                    $.ajax({
                        url: "/api/ginapi/matchGin",
                        type: "GET",
                        data: { partial: request.term },
                        success: function(data) {
                            response($.map(data, function(item) {
                                return{
                                    label: item.distillery + " " + item.ginName,
                                    value: item.distillery + " " + item.ginName,
                                    id: item.ginId
                                };
                            }));
                        },
                        error: function(xhr, status, error){
                            $("#searchResult").text("An error occured: " + error);
                        }
                    });
                },
                minLength: 2,
                autoFocus: true,
                select: function(event, ui) {
                    selectedGinId = ui.item.id
                    console.log("selected ginid: "+ selectedGinId);
                }
            });
        });
</script>
}
